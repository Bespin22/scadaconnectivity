<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCADA - Home and IP Management</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>SCADA Application</h1>
    <nav>
      <button onclick="showSection('home')">Home</button>
      <button onclick="showSection('ip-management')">IP Management</button>
    </nav>
  </header>

  <!-- Home Section -->
  <section id="home" class="section">
    <h2>Home</h2>
    <div id="home-status" class="box-container">Loading IP statuses...</div>
  </section>

  <!-- IP Management Section -->
  <section id="ip-management" class="section hidden">
    <h2>IP Management</h2>

    <!-- Add New IP -->
    <h3>Add New IP</h3>
    <div class="box-container">
      <form id="add-ip-form" class="form-container">
        <input type="text" id="ipName" placeholder="Name" required />
        <input type="text" id="ipAddress" placeholder="IP Address" required />
        <select id="ipSite" required>
          <option value="" disabled selected>Select Site</option>
          <option value="GE58">GE58</option>
          <option value="GE97">GE97</option>
        </select>
        <button type="submit">Add IP</button>
      </form>
    </div>

    <!-- IP List -->
    <h3>IP List</h3>
    <div id="ip-list" class="box-container">Loading IP list...</div>

    <!-- Deleted IPs -->
    <h3>Deleted IPs</h3>
    <div id="deleted-ips" class="box-container">Loading deleted IPs...</div>
  </section>

  <script>
    const API_BASE_URL = "http://localhost:3000";

    // Function to show the selected section
    function showSection(sectionId) {
      document.querySelectorAll(".section").forEach((section) => {
        section.classList.add("hidden");
      });
      document.getElementById(sectionId).classList.remove("hidden");
    }

    // Fetch and display IP statuses in Home
    async function fetchIPStatus() {
      const response = await fetch(`${API_BASE_URL}/ping`);
      const data = await response.json();
      const homeStatusDiv = document.getElementById("home-status");
      homeStatusDiv.innerHTML = data
        .map(
          (ip) => `
          <div class="box ${
            ip.status === "Connected" ? "connected" : "disconnected"
          }">
            <p><strong>Name:</strong> ${ip.name}</p>
            <p><strong>IP:</strong> ${ip.ip}</p>
            <p><strong>Site:</strong> ${ip.site}</p>
            <p><strong>Status:</strong> ${ip.status}</p>
          </div>`
        )
        .join("");
    }

    // Fetch and display IP list in IP Management
    async function fetchIPList() {
      const response = await fetch(`${API_BASE_URL}/ping`);
      const data = await response.json();
      const ipListDiv = document.getElementById("ip-list");
      ipListDiv.innerHTML = data
        .map(
          (ip) => `
          <div class="box">
            <p><strong>Name:</strong> ${ip.name}</p>
            <p><strong>IP:</strong> ${ip.ip}</p>
            <p><strong>Site:</strong> ${ip.site}</p>
            <button onclick="editIP('${ip.name}', '${ip.ip}', '${ip.site}')">‚úèÔ∏è Edit</button>
            <button onclick="deleteIP('${ip.ip}')">üóëÔ∏è Delete</button>
          </div>`
        )
        .join("");
    }

    // Fetch and display deleted IPs
    async function fetchDeletedIPs() {
      const response = await fetch(`${API_BASE_URL}/deleted-ips`);
      const data = await response.json();
      const deletedIpsDiv = document.getElementById("deleted-ips");
      deletedIpsDiv.innerHTML = data
        .map(
          (ip) => `
          <div class="box">
            <p><strong>Name:</strong> ${ip.name}</p>
            <p><strong>IP:</strong> ${ip.ip}</p>
            <p><strong>Site:</strong> ${ip.site}</p>
            <button onclick="restoreIP('${ip.ip}')">‚ôªÔ∏è Restore</button>
            <button onclick="permanentlyDeleteIP('${ip.ip}')">‚ùå Permanently Delete</button>
          </div>`
        )
        .join("");
    }

    // Add a new IP
    document.getElementById("add-ip-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("ipName").value;
      const ip = document.getElementById("ipAddress").value;
      const site = document.getElementById("ipSite").value;

      const response = await fetch(`${API_BASE_URL}/add-ip`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, ip, site }),
      });

      if (response.ok) {
        fetchIPList();
        fetchDeletedIPs();
        e.target.reset();
      }
    });

    // Edit an IP
    async function editIP(currentName, currentIp, currentSite) {
      const newName = prompt("Enter new name:", currentName);
      const newIp = prompt("Enter new IP address:", currentIp);
      const newSite = prompt("Enter new site (GE58 or GE97):", currentSite);

      if (newName && newIp && newSite) {
        const response = await fetch(`${API_BASE_URL}/edit-ip`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ oldIp: currentIp, name: newName, ip: newIp, site: newSite }),
        });
        if (response.ok) {
          fetchIPList();
        }
      }
    }

    // Delete an IP
    async function deleteIP(ip) {
      await fetch(`${API_BASE_URL}/delete-ip/${ip}`, { method: "DELETE" });
      fetchIPList();
      fetchDeletedIPs();
    }

    // Restore a deleted IP
    async function restoreIP(ip) {
      await fetch(`${API_BASE_URL}/restore-ip/${ip}`, { method: "POST" });
      fetchIPList();
      fetchDeletedIPs();
    }

    // Permanently delete an IP from the deleted list
    async function permanentlyDeleteIP(ip) {
      await fetch(`${API_BASE_URL}/permanently-delete-ip/${ip}`, { method: "DELETE" });
      fetchDeletedIPs();
    }

    // Initialize data
    fetchIPStatus();
    fetchIPList();
    fetchDeletedIPs();
  </script>
</body>
</html>
